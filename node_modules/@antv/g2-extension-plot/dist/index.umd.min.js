!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("@antv/g2")):"function"==typeof define&&define.amd?define(["exports","@antv/g2"],e):e(((t="undefined"!=typeof globalThis?globalThis:t||self).G2=t.G2||{},t.G2.ExtensionPlot={}),t.window.G2)}(this,(function(t,e){"use strict";function n(t,e,n,r){return new(n||(n=Promise))((function(o,i){function a(t){try{s(r.next(t))}catch(t){i(t)}}function c(t){try{s(r.throw(t))}catch(t){i(t)}}function s(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(a,c)}s((r=r.apply(t,e||[])).next())}))}"function"==typeof SuppressedError&&SuppressedError;var r=function(t){return null!==t&&"function"!=typeof t&&isFinite(t.length)},o=function(t,e){if(!r(t))return t;for(var n=[],o=0;t.length>o;o++){var i=t[o];e(i,o)&&n.push(i)}return n},i=function(t){return null==t},a={}.toString,c=function(t,e){return a.call(t)==="[object "+e+"]"},s=function(t){return Array.isArray?Array.isArray(t):c(t,"Array")};function u(t,e){var n,r;if(t)if(s(t))for(var o=0,i=t.length;i>o&&!1!==e(t[o],o);o++);else if(r=typeof(n=t),null!==n&&"object"===r||"function"===r)for(var a in t)if(t.hasOwnProperty(a)&&!1===e(t[a],a))break}var l=Object.keys?function(t){return Object.keys(t)}:function(t){var e=[];return u(t,(function(n,r){(function(t){return"function"==typeof t})(t)&&"prototype"===r||e.push(r)})),e},f=function(t){return"object"==typeof t&&null!==t},d=function(t){if(!f(t)||!c(t,"Object"))return!1;if(null===Object.getPrototypeOf(t))return!0;for(var e=t;null!==Object.getPrototypeOf(e);)e=Object.getPrototypeOf(e);return Object.getPrototypeOf(t)===e},h=function(t,e,n){if(!s(t)&&!d(t))return t;var r=n;return u(t,(function(t,n){r=e(r,t,n)})),r},p=function(t){return c(t,"String")};function v(t,e){for(var n in e)e.hasOwnProperty(n)&&"constructor"!==n&&void 0!==e[n]&&(t[n]=e[n])}function y(t,e){if(Object.hasOwn)return Object.hasOwn(t,e);if(null==t)throw new TypeError("Cannot convert undefined or null to object");return Object.prototype.hasOwnProperty.call(Object(t),e)}function g(t,e,n,r){for(var o in n=n||0,r=r||5,e)if(y(e,o)){var i=e[o];null!==i&&d(i)?(d(t[o])||(t[o]={}),r>n?g(t[o],i,n+1,r):t[o]=e[o]):s(i)?(t[o]=[],t[o]=t[o].concat(i)):void 0!==i&&(t[o]=i)}}var b=function(t){for(var e=[],n=1;arguments.length>n;n++)e[n-1]=arguments[n];for(var r=0;e.length>r;r+=1)g(t,e[r]);return t},x=function(t,e,n){for(var r=0,o=p(e)?e.split("."):e;t&&o.length>r;)t=t[o[r++]];return void 0===t||o.length>r?n:t},m=Object.prototype.hasOwnProperty,O=function(t,e){if(null===t||!d(t))return{};var n={};return u(e,(function(e){m.call(t,e)&&(n[e]=t[e])})),n};function j(t){var e=0,n=t.children,r=n&&n.length;if(r)for(;--r>=0;)e+=n[r].value;else e=1;t.value=e}function w(t,e){t instanceof Map?(t=[void 0,t],void 0===e&&(e=B)):void 0===e&&(e=E);for(var n,r,o,i,a,c=new P(t),s=[c];n=s.pop();)if((o=e(n.data))&&(a=(o=Array.from(o)).length))for(n.children=o,i=a-1;i>=0;--i)s.push(r=o[i]=new P(o[i])),r.parent=n,r.depth=n.depth+1;return c.eachBefore(A)}function E(t){return t.children}function B(t){return Array.isArray(t)?t[1]:null}function k(t){void 0!==t.data.value&&(t.value=t.data.value),t.data=t.data.data}function A(t){var e=0;do{t.height=e}while((t=t.parent)&&t.height<++e)}function P(t){this.data=t,this.depth=this.height=0,this.parent=null}function S(t){t.x0=Math.round(t.x0),t.y0=Math.round(t.y0),t.x1=Math.round(t.x1),t.y1=Math.round(t.y1)}function L(){var t=1,e=1,n=0,r=!1;function o(o){var i=o.height+1;return o.x0=o.y0=n,o.x1=t,o.y1=e/i,o.eachBefore(function(t,e){return function(r){r.children&&function(t,e,n,r,o){for(var i,a=t.children,c=-1,s=a.length,u=t.value&&(r-e)/t.value;++c<s;)(i=a[c]).y0=n,i.y1=o,i.x0=e,i.x1=e+=i.value*u}(r,r.x0,t*(r.depth+1)/e,r.x1,t*(r.depth+2)/e);var o=r.x0,i=r.y0,a=r.x1-n,c=r.y1-n;o>a&&(o=a=(o+a)/2),i>c&&(i=c=(i+c)/2),r.x0=o,r.y0=i,r.x1=a,r.y1=c}}(e,i)),r&&o.eachBefore(S),o}return o.round=function(t){return arguments.length?(r=!!t,o):r},o.size=function(n){return arguments.length?(t=+n[0],e=+n[1],o):[t,e]},o.padding=function(t){return arguments.length?(n=+t,o):n},o}P.prototype=w.prototype={constructor:P,count:function(){return this.eachAfter(j)},each:function(t,e){let n=-1;for(const r of this)t.call(e,r,++n,this);return this},eachAfter:function(t,e){for(var n,r,o,i=this,a=[i],c=[],s=-1;i=a.pop();)if(c.push(i),n=i.children)for(r=0,o=n.length;o>r;++r)a.push(n[r]);for(;i=c.pop();)t.call(e,i,++s,this);return this},eachBefore:function(t,e){for(var n,r,o=this,i=[o],a=-1;o=i.pop();)if(t.call(e,o,++a,this),n=o.children)for(r=n.length-1;r>=0;--r)i.push(n[r]);return this},find:function(t,e){let n=-1;for(const r of this)if(t.call(e,r,++n,this))return r},sum:function(t){return this.eachAfter((function(e){for(var n=+t(e.data)||0,r=e.children,o=r&&r.length;--o>=0;)n+=r[o].value;e.value=n}))},sort:function(t){return this.eachBefore((function(e){e.children&&e.children.sort(t)}))},path:function(t){for(var e=this,n=function(t,e){if(t===e)return t;var n=t.ancestors(),r=e.ancestors(),o=null;t=n.pop(),e=r.pop();for(;t===e;)o=t,t=n.pop(),e=r.pop();return o}(e,t),r=[e];e!==n;)r.push(e=e.parent);for(var o=r.length;t!==n;)r.splice(o,0,t),t=t.parent;return r},ancestors:function(){for(var t=this,e=[t];t=t.parent;)e.push(t);return e},descendants:function(){return Array.from(this)},leaves:function(){var t=[];return this.eachBefore((function(e){e.children||t.push(e)})),t},links:function(){var t=this,e=[];return t.each((function(n){n!==t&&e.push({source:n.parent,target:n})})),e},copy:function(){return w(this).eachBefore(k)},[Symbol.iterator]:function*(){var t,e,n,r,o=this,i=[o];do{for(t=i.reverse(),i=[];o=t.pop();)if(yield o,e=o.children)for(n=0,r=e.length;r>n;++n)i.push(e[n])}while(i.length)}};const C={field:"value",size:[1,1],round:!1,padding:0,sort:(t,e)=>e.value-t.value,as:["x","y"],ignoreParentValue:!0},T="nodeIndex",M="childNodeCount",z="nodeAncestor",D="Invalid field: it must be a string!";function I(t,e){var n,a,c,u;n={},c=e,(a=C)&&v(n,a),c&&v(n,c),u&&v(n,u);const l=(e=n).as;if(!s(l)||2!==l.length)throw new TypeError('Invalid as: it must be an array with 2 strings (e.g. [ "x", "y" ])!');let f;try{f=function(t,e){const{field:n,fields:r}=t;if(p(n))return n;if(s(n))return console.warn(D),n[0];if(console.warn(D+" will try to get fields instead."),p(r))return r;if(s(r)&&r.length)return r[0];if(e)return e;throw new TypeError(D)}(e)}catch(t){console.warn(t)}const d=(t=>L().size(e.size).round(e.round).padding(e.padding)(w(t).sum((t=>{return!i(n=t.children)&&(r(n)?n.length:Object.keys(n).length)?e.ignoreParentValue?0:t[f]-h(t.children,((t,e)=>t+e[f]),0):t[f];var n})).sort(e.sort)))(t),y=l[0],g=l[1];return d.each((t=>{var e,n;t[y]=[t.x0,t.x1,t.x1,t.x0],t[g]=[t.y1,t.y1,t.y0,t.y0],t.name=t.name||(null===(e=t.data)||void 0===e?void 0:e.name)||(null===(n=t.data)||void 0===n?void 0:n.label),t.data.name=t.name,["x0","x1","y0","y1"].forEach((e=>{-1===l.indexOf(e)&&delete t[e]}))})),function(t){const e=[];if(t&&t.each){let n,r;t.each((t=>{var i,a;t.parent!==n?(n=t.parent,r=0):r+=1;const c=o(((null===(i=t.ancestors)||void 0===i?void 0:i.call(t))||[]).map((t=>e.find((e=>e.name===t.name))||t)),(({depth:e})=>e>0&&t.depth>e));t[z]=c,t[M]=(null===(a=t.children)||void 0===a?void 0:a.length)||0,t[T]=r,e.push(t)}))}else t&&t.eachNode&&t.eachNode((t=>{e.push(t)}));return e}(d)}const $="sunburst",_="markType",G="path",N="ancestor-node";const R={id:$,encode:{x:"x",y:"y",key:G,color:N,value:"value"},axis:{x:!1,y:!1},style:{[_]:$,stroke:"#fff",lineWidth:.5,fillOpacity:"fillOpacity",[M]:M,depth:"depth"},state:{active:{zIndex:2,stroke:"#000"},inactive:{zIndex:1,stroke:"#fff"}},legend:!1,interaction:{drillDown:!0},coordinate:{type:"polar",innerRadius:.2}},q=t=>{const{encode:e,data:n=[]}=t,r=function(t,e){var n={};for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&0>e.indexOf(r)&&(n[r]=t[r]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(r=Object.getOwnPropertySymbols(t);r.length>o;o++)0>e.indexOf(r[o])&&Object.prototype.propertyIsEnumerable.call(t,r[o])&&(n[r[o]]=t[r[o]])}return n}(t,["encode","data","legend"]),o=Object.assign(Object.assign({},r.coordinate),{innerRadius:Math.max(x(r,["coordinate","innerRadius"],.2),1e-5)}),i=Object.assign(Object.assign({},R.encode),e),{value:a}=i,c=function(t){const{data:e,encode:n}=t,{color:r,value:o}=n,i=I(e,{field:o,type:"hierarchy.partition",as:["x","y"]}),a=[];return i.forEach((t=>{var e,n,i,c;if(0===t.depth)return null;let s=t.data.name;const u=[s];let l=Object.assign({},t);for(;l.depth>1;)s=`${null===(e=l.parent.data)||void 0===e?void 0:e.name} / ${s}`,u.unshift(null===(n=l.parent.data)||void 0===n?void 0:n.name),l=l.parent;const f=Object.assign(Object.assign(Object.assign({},O(t.data,[o])),{[G]:s,[N]:l.data.name}),t);r&&r!==N&&(f[r]=t.data[r]||(null===(c=null===(i=t.parent)||void 0===i?void 0:i.data)||void 0===c?void 0:c[r])),a.push(f)})),a.map((t=>{const e=t.x.slice(0,2),n=[t.y[2],t.y[0]];return e[0]===e[1]&&(n[0]=n[1]=(t.y[2]+t.y[0])/2),Object.assign(Object.assign({},t),{x:e,y:n,fillOpacity:Math.pow(.85,t.depth)})}))}({encode:i,data:n});return console.log(c,"rectData"),[b({},R,Object.assign(Object.assign({type:"rect",data:c,encode:i,tooltip:{title:"path",items:[t=>({name:a,value:t[a]})]}},r),{coordinate:o}))]};q.props={};const F=t=>t.querySelectorAll(".element").filter((t=>x(t,["style",_])===$));const V={rootText:"root",style:{fill:"rgba(0, 0, 0, 0.85)",fontSize:12,y:1},active:{fill:"rgba(0, 0, 0, 0.5)"}};function W(t={}){const{breadCrumb:r={},isFixedColor:o=!1}=t,i=b({},V,r);return t=>{const{update:r,setState:a,container:c,view:s,options:u}=t,f=c.ownerDocument,d=e.select(c).select("."+e.PLOT_CLASS_NAME).node();const h=u.marks.find((({id:t})=>t===$)),{state:p}=h,v=f.createElement("g");d.appendChild(v);const y=(t,e)=>n(this,void 0,void 0,(function*(){if(v.removeChildren(),t){const e=f.createElement("text",{style:Object.assign({x:0,text:i.rootText,depth:0},i.style)});v.appendChild(e);let n="";const r=null==t?void 0:t.split(" / ");let o=i.style.y,a=v.getBBox().width;const c=d.getBBox().width,s=r.map(((t,e)=>{const r=f.createElement("text",{style:Object.assign(Object.assign({x:a,text:" / "},i.style),{y:o})});v.appendChild(r),a+=r.getBBox().width,n=`${n}${t} / `;const s=f.createElement("text",{name:n.replace(/\s\/\s$/,""),style:Object.assign(Object.assign({text:t,x:a,depth:e+1},i.style),{y:o})});return v.appendChild(s),a+=s.getBBox().width,a>c&&(o=v.getBBox().height,a=0,r.attr({x:a,y:o}),a+=r.getBBox().width,s.attr({x:a,y:o}),a+=s.getBBox().width),s}));[e,...s].forEach(((t,e)=>{if(e===s.length)return;const n=Object.assign({},t.attributes);t.attr("cursor","pointer"),t.addEventListener("mouseenter",(()=>{t.attr(i.active)})),t.addEventListener("mouseleave",(()=>{t.attr(n)})),t.addEventListener("click",(()=>{y(t.name,x(t,["style","depth"]))}))}))}a("drillDown",(n=>{const{marks:r}=n,i=r.map((n=>{if(n.id!==$&&"rect"!==n.type)return n;const{data:r}=n,i=Object.fromEntries(["color"].map((t=>[t,{domain:s.scale[t].getOptions().domain}]))),a=r.filter((n=>{const r=n.path;if(o||(n[N]=r.split(" / ")[e]),!t)return!0;return RegExp(`^${t}.+`).test(r)}));return b({},n,o?{data:a,scale:i}:{data:a})}));return Object.assign(Object.assign({},n),{marks:i})})),yield r()})),g=t=>{const e=t.target;if(x(e,["style",_])!==$||"rect"!==x(e,["markType"])||!x(e,["style",M]))return;const n=x(e,["__data__","key"]),r=x(e,["style","depth"]);e.style.cursor="pointer",y(n,r)};d.addEventListener("click",g);const m=l(Object.assign(Object.assign({},p.active),p.inactive)),j=()=>{F(d).forEach((t=>{const e=x(t,["style",M]);if("pointer"!==x(t,["style","cursor"])&&e){t.style.cursor="pointer";const e=O(t.attributes,m);t.addEventListener("mouseenter",(()=>{t.attr(p.active)})),t.addEventListener("mouseleave",(()=>{t.attr(b(e,p.inactive))}))}}))};return d.addEventListener("mousemove",j),()=>{v.remove(),d.removeEventListener("click",g),d.removeEventListener("mousemove",j)}}}t.DrillDown=W,t.Sunburst=q,t.plotlib=function(){return{"interaction.drillDown":W,"mark.sunburst":q}}}));
//# sourceMappingURL=index.umd.min.js.map
