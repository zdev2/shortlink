{"version":3,"file":"index.esm.js","sources":["../src/AdvancedCamera.ts","../src/index.ts"],"sourcesContent":["import {\n  Camera,\n  CameraType,\n  getAngle,\n  createVec3,\n  deg2rad,\n  runtime,\n} from '@antv/g-lite';\nimport { isString, isNumber } from '@antv/util';\nimport { mat4, quat, vec3 } from 'gl-matrix';\nimport type { vec2 } from 'gl-matrix';\nimport type { TypeEasingFunction, Landmark } from '@antv/g-lite';\n\n/**\n * Provides camera action & animation.\n */\nexport class AdvancedCamera extends Camera {\n  /**\n   * switch between multiple landmarks\n   */\n  private landmarks: Landmark[] = [];\n  private landmarkAnimationID: number | undefined;\n\n  /**\n   * Changes the azimuth and elevation with respect to the current camera axes\n   * @param {Number} azimuth the relative azimuth\n   * @param {Number} elevation the relative elevation\n   * @param {Number} roll the relative roll\n   */\n  rotate(azimuth: number, elevation: number, roll: number) {\n    this.relElevation = getAngle(elevation);\n    this.relAzimuth = getAngle(azimuth);\n    this.relRoll = getAngle(roll);\n    this.elevation += this.relElevation;\n    this.azimuth += this.relAzimuth;\n    this.roll += this.relRoll;\n\n    if (this.type === CameraType.EXPLORING) {\n      const rotX = quat.setAxisAngle(\n        quat.create(),\n        [1, 0, 0],\n        deg2rad((this.rotateWorld ? 1 : -1) * this.relElevation),\n      );\n      const rotY = quat.setAxisAngle(\n        quat.create(),\n        [0, 1, 0],\n        deg2rad((this.rotateWorld ? 1 : -1) * this.relAzimuth),\n      );\n\n      const rotZ = quat.setAxisAngle(\n        quat.create(),\n        [0, 0, 1],\n        deg2rad(this.relRoll),\n      );\n      let rotQ = quat.multiply(quat.create(), rotY, rotX);\n      rotQ = quat.multiply(quat.create(), rotQ, rotZ);\n      const rotMatrix = mat4.fromQuat(mat4.create(), rotQ);\n      mat4.translate(this.matrix, this.matrix, [0, 0, -this.distance]);\n      mat4.multiply(this.matrix, this.matrix, rotMatrix);\n      mat4.translate(this.matrix, this.matrix, [0, 0, this.distance]);\n    } else {\n      if (Math.abs(this.elevation) > 90) {\n        return this;\n      }\n      this.computeMatrix();\n    }\n\n    this._getAxes();\n    if (\n      this.type === CameraType.ORBITING ||\n      this.type === CameraType.EXPLORING\n    ) {\n      this._getPosition();\n    } else if (this.type === CameraType.TRACKING) {\n      this._getFocalPoint();\n    }\n\n    this._update();\n    return this;\n  }\n\n  /**\n   * 沿水平(right) & 垂直(up)平移相机\n   */\n  pan(tx: number, ty: number) {\n    const coords = createVec3(tx, ty, 0);\n    const pos = vec3.clone(this.position);\n\n    vec3.add(pos, pos, vec3.scale(vec3.create(), this.right, coords[0]));\n    vec3.add(pos, pos, vec3.scale(vec3.create(), this.up, coords[1]));\n\n    this._setPosition(pos);\n\n    this.triggerUpdate();\n\n    return this;\n  }\n\n  /**\n   * 沿 n 轴移动，当距离视点远时移动速度较快，离视点越近速度越慢\n   */\n  dolly(value: number) {\n    const n = this.forward;\n    const pos = vec3.clone(this.position);\n    let step = value * this.dollyingStep;\n    const updatedDistance = this.distance + value * this.dollyingStep;\n\n    // 限制视点距离范围\n    step =\n      Math.max(Math.min(updatedDistance, this.maxDistance), this.minDistance) -\n      this.distance;\n    pos[0] += step * n[0];\n    pos[1] += step * n[1];\n    pos[2] += step * n[2];\n\n    this._setPosition(pos);\n    if (\n      this.type === CameraType.ORBITING ||\n      this.type === CameraType.EXPLORING\n    ) {\n      // 重新计算视点距离\n      this._getDistance();\n    } else if (this.type === CameraType.TRACKING) {\n      // 保持视距，移动视点位置\n      vec3.add(this.focalPoint, pos, this.distanceVector);\n    }\n\n    this.triggerUpdate();\n    return this;\n  }\n\n  cancelLandmarkAnimation() {\n    if (this.landmarkAnimationID !== undefined) {\n      this.canvas.cancelAnimationFrame(this.landmarkAnimationID);\n    }\n  }\n\n  createLandmark(\n    name: string,\n    params: Partial<{\n      position: vec3 | vec2;\n      focalPoint: vec3 | vec2;\n      zoom: number;\n      roll: number;\n    }> = {},\n  ): Landmark {\n    const {\n      position = this.position,\n      focalPoint = this.focalPoint,\n      roll,\n      zoom,\n    } = params;\n\n    const camera = new runtime.CameraContribution() as AdvancedCamera;\n    camera.setType(this.type, undefined);\n    camera.setPosition(\n      position[0],\n      position[1] ?? this.position[1],\n      position[2] ?? this.position[2],\n    );\n    camera.setFocalPoint(\n      focalPoint[0],\n      focalPoint[1] ?? this.focalPoint[1],\n      focalPoint[2] ?? this.focalPoint[2],\n    );\n    camera.setRoll(roll ?? this.roll);\n    camera.setZoom(zoom ?? this.zoom);\n\n    const landmark: Landmark = {\n      name,\n      matrix: mat4.clone(camera.getWorldTransform()),\n      right: vec3.clone(camera.right),\n      up: vec3.clone(camera.up),\n      forward: vec3.clone(camera.forward),\n      position: vec3.clone(camera.getPosition()),\n      focalPoint: vec3.clone(camera.getFocalPoint()),\n      distanceVector: vec3.clone(camera.getDistanceVector()),\n      distance: camera.getDistance(),\n      dollyingStep: camera.getDollyingStep(),\n      azimuth: camera.getAzimuth(),\n      elevation: camera.getElevation(),\n      roll: camera.getRoll(),\n      relAzimuth: camera.relAzimuth,\n      relElevation: camera.relElevation,\n      relRoll: camera.relRoll,\n      zoom: camera.getZoom(),\n    };\n\n    this.landmarks.push(landmark);\n    return landmark;\n  }\n\n  gotoLandmark(\n    name: string | Landmark,\n    options:\n      | number\n      | Partial<{\n          easing: string;\n          easingFunction: TypeEasingFunction;\n          duration: number;\n          onframe: (t: number) => void;\n          onfinish: () => void;\n        }> = {},\n  ) {\n    const landmark = isString(name)\n      ? this.landmarks.find((l) => l.name === name)\n      : name;\n    if (landmark) {\n      const {\n        easing = 'linear',\n        duration = 100,\n        easingFunction = undefined,\n        onfinish = undefined,\n        onframe = undefined,\n      } = isNumber(options) ? { duration: options } : options;\n      const epsilon = 0.01;\n\n      // cancel ongoing animation\n      this.cancelLandmarkAnimation();\n\n      const destPosition = landmark.position;\n      const destFocalPoint = landmark.focalPoint;\n      const destZoom = landmark.zoom;\n      const destRoll = landmark.roll;\n\n      const easingFunc = easingFunction || runtime.EasingFunction(easing);\n\n      let timeStart: number | undefined;\n      const end = () => {\n        this.setFocalPoint(destFocalPoint);\n        this.setPosition(destPosition);\n        this.setRoll(destRoll);\n        this.setZoom(destZoom);\n        this.computeMatrix();\n        this.triggerUpdate();\n        onfinish?.();\n      };\n\n      if (duration === 0) return end();\n\n      const animate = (timestamp: number) => {\n        if (timeStart === undefined) {\n          timeStart = timestamp;\n        }\n        const elapsed = timestamp - timeStart;\n\n        if (elapsed >= duration) {\n          end();\n          return;\n        }\n        // use the same ease function in animation system\n        const t = easingFunc(elapsed / duration);\n\n        const interFocalPoint = vec3.create();\n        const interPosition = vec3.create();\n        let interZoom = 1;\n        let interRoll = 0;\n\n        vec3.lerp(interFocalPoint, this.focalPoint, destFocalPoint, t);\n        vec3.lerp(interPosition, this.position, destPosition, t);\n        interRoll = this.roll * (1 - t) + destRoll * t;\n        interZoom = this.zoom * (1 - t) + destZoom * t;\n\n        this.setFocalPoint(interFocalPoint);\n        this.setPosition(interPosition);\n        this.setRoll(interRoll);\n        this.setZoom(interZoom);\n\n        const dist =\n          vec3.dist(interFocalPoint, destFocalPoint) +\n          vec3.dist(interPosition, destPosition);\n        if (\n          dist <= epsilon &&\n          destZoom === undefined &&\n          destRoll === undefined\n        ) {\n          return end();\n        }\n\n        this.computeMatrix();\n        this.triggerUpdate();\n\n        if (elapsed < duration) {\n          onframe?.(t);\n          this.landmarkAnimationID = this.canvas.requestAnimationFrame(animate);\n        }\n      };\n\n      this.canvas.requestAnimationFrame(animate);\n    }\n  }\n\n  /**\n   * Sets the camera to a distance such that the area covered by the bounding box is viewed.\n   */\n  // shot(displayObject: DisplayObject) {\n  //   const aabb = displayObject.getBounds();\n\n  //   if (!AABB.isEmpty(aabb)) {\n  //     this.setElevation(0);\n  //     this.setAzimuth(0);\n  //     this.setRoll(0);\n\n  //     const { halfExtents, center } = aabb;\n  //     const maxDim = Math.max(halfExtents[0] * 2, halfExtents[1] * 2);\n\n  //     const cc = center.map((c: number) => Math.round(c * 1000) / 1000) as [number, number, number];\n\n  //     if (maxDim !== 0) {\n  //       const d = (1.5 * maxDim) / Math.tan(this.fov * DEG_2_RAD);\n  //       this.setPosition([cc[0], cc[1], cc[2] + d]);\n  //     }\n\n  //     this.setFocalPoint(cc);\n  //   }\n  // }\n}\n","import { runtime } from '@antv/g-lite';\nimport { AdvancedCamera } from './AdvancedCamera';\n\nexport { AdvancedCamera };\n\nruntime.CameraContribution = AdvancedCamera;\n"],"names":["AdvancedCamera","_Camera","_this","_classCallCheck","_len","arguments","length","args","Array","_key","_callSuper","concat","landmarks","_inherits","_createClass","key","value","rotate","azimuth","elevation","roll","relElevation","getAngle","relAzimuth","relRoll","type","CameraType","EXPLORING","rotX","quat","setAxisAngle","create","deg2rad","rotateWorld","rotY","rotZ","rotQ","multiply","rotMatrix","mat4","fromQuat","translate","matrix","distance","Math","abs","computeMatrix","_getAxes","ORBITING","_getPosition","TRACKING","_getFocalPoint","_update","pan","tx","ty","coords","createVec3","pos","vec3","clone","position","add","scale","right","up","_setPosition","triggerUpdate","dolly","n","forward","step","dollyingStep","updatedDistance","max","min","maxDistance","minDistance","_getDistance","focalPoint","distanceVector","cancelLandmarkAnimation","landmarkAnimationID","undefined","canvas","cancelAnimationFrame","createLandmark","name","_position$","_position$2","_focalPoint$","_focalPoint$2","params","_params$position","_params$focalPoint","zoom","camera","runtime","CameraContribution","setType","setPosition","setFocalPoint","setRoll","setZoom","landmark","getWorldTransform","getPosition","getFocalPoint","getDistanceVector","getDistance","getDollyingStep","getAzimuth","getElevation","getRoll","getZoom","push","gotoLandmark","_this2","options","isString","find","l","_ref","isNumber","duration","_ref$easing","easing","_ref$duration","_ref$easingFunction","easingFunction","_ref$onfinish","onfinish","_ref$onframe","onframe","epsilon","destPosition","destFocalPoint","destZoom","destRoll","easingFunc","EasingFunction","timeStart","end","animate","timestamp","elapsed","t","interFocalPoint","interPosition","interZoom","interRoll","lerp","dist","requestAnimationFrame","Camera"],"mappings":"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"}